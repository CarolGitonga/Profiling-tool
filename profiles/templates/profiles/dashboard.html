{% load profile_extras %}
<!DOCTYPE html>
<html>
<head>
    <title>User Profile Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f2f2f2;
        }

        .card {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #fff;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .card img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
        }

        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        .remove-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>

{% if profiles %}
    <h1>Dashboard for <strong>{{ profiles.0.username }}</strong></h1>

    {% for profile in profiles %}
        <div class="card">
            <h2>{{ profile.platform }} Profile</h2>

            {% if profile.avatar_url %}
                <img src="{{ profile.avatar_url }}" alt="{{ profile.platform }} avatar"><br><br>
            {% else %}
                <p>No profile image available</p>
            {% endif %}

            <p><strong>Full Name:</strong> {{ profile.full_name|default:"Not available" }}</p>

            {% with accounts|get_account_for:profile as account %}
                {% if profile.platform == 'GitHub' %}
                    {% if account %}
                        <p><strong>Bio:</strong> {{ account.bio|default:"No bio provided" }}</p>
                        <p><strong>Followers:</strong> {{ account.followers }}</p>
                        <p><strong>Following:</strong> {{ account.following }}</p>
                        <p><strong>Public Repositories:</strong> {{ account.public_repos }}</p>
                        <p><strong>Company:</strong> {{ profile.company|default:"Not specified" }}</p>
                        <p><strong>Location:</strong> {{ profile.location|default:"Not specified" }}</p>
                        <p><strong>Website:</strong>
                            {% if profile.blog %}
                                <a href="{{ profile.blog }}" target="_blank">{{ profile.blog }}</a>
                            {% else %}
                                Not specified
                            {% endif %}
                        </p>
                        <p><strong>GitHub Joined:</strong> {{ profile.github_created_at|date:"F Y" }}</p>
                        <form action="{% url 'unscrape_github' profile.username %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="remove-btn">Remove GitHub Data</button>
                        </form>
                    {% else %}
                        <p><em>GitHub profile is being scraped. Please refresh soon.</em></p>
                    {% endif %}

                {% elif profile.platform == 'Twitter' %}
                    {% if account %}
                        <p><strong>Bio:</strong> {{ account.bio|default:"No bio provided" }}</p>
                        <p><strong>Followers:</strong> {{ account.followers }}</p>
                        <p><strong>Following:</strong> {{ account.following }}</p>
                        <p><strong>Verified:</strong> {{ profile.verified|yesno:"Yes,No" }}</p>
                        <p><strong>Location:</strong> {{ profile.location|default:"Not specified" }}</p>
                        <p><strong>Twitter Joined:</strong> {{ profile.profile_created_at|date:"F Y" }}</p>
                        <form action="{% url 'unscrape_twitter' profile.username %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="remove-btn">Remove Twitter Data</button>
                        </form>
                    {% else %}
                        <p><em>Twitter profile is being scraped. Please refresh soon.</em></p>
                    {% endif %}

                {% elif profile.platform == 'Instagram' %}
                    {% if account %}
                        <p><strong>Bio:</strong> {{ account.bio|default:"No bio provided" }}</p>
                        <p><strong>Followers:</strong> {{ account.followers }}</p>
                        <p><strong>Following:</strong> {{ account.following }}</p>
                        <p><strong>Posts:</strong> {{ account.posts_collected }}</p>
                        <p><strong>Verified:</strong> {{ account.is_verified|yesno:"Yes,No" }}</p>
                        <p><strong>External URL:</strong>
                            {% if profile.blog %}
                                <a href="{{ profile.blog }}" target="_blank">{{ profile.blog }}</a>
                            {% else %}
                                Not provided
                            {% endif %}
                        </p>
                        <form action="{% url 'unscrape_instagram' profile.username %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="remove-btn">Remove Instagram Data</button>
                        </form>
                    {% else %}
                        <p><em>Instagram profile is still being scraped. Please refresh this page in a few seconds.</em></p>
                    {% endif %}

                {% elif profile.platform == 'TikTok' %}
                    {% if account %}
                        <p><strong>Bio:</strong> {{ account.bio|default:"No bio provided" }}</p>
                        <p><strong>Followers:</strong> {{ account.followers }}</p>
                        <p><strong>Following:</strong> {{ account.following }}</p>
                        <p><strong>Videos:</strong> {{ account.videos }}</p>
                        <p><strong>Total Likes (Hearts):</strong> {{ account.hearts }}</p>
                        <p><strong>Verified:</strong> {{ account.verified|yesno:"Yes,No" }}</p>
                        <p><strong>Region:</strong> {{ account.tiktok_region|default:"Not specified" }}</p>
                        <p><strong>Bio Link:</strong>
                            {% if account.tiktok_bio_link %}
                                <a href="{{ account.tiktok_bio_link }}" target="_blank">{{ account.tiktok_bio_link }}</a>
                            {% else %}
                                Not provided
                            {% endif %}
                        </p>
                        <form action="{% url 'unscrape_tiktok' profile.username %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="remove-btn">Remove TikTok Data</button>
                        </form>
                    {% else %}
                        <p><em>TikTok profile is still being scraped. Please refresh this page in a few seconds.</em></p>
                    {% endif %}
                {% endif %}
            {% endwith %}

            <p><em>Profiled {{ profile.date_profiled|timesince }} ago</em></p>
        </div>
    {% endfor %}

{% else %}
    <p>No profiles found for this user.</p>
{% endif %}

<br>
<a href="{% url 'search_profile' %}">‚Üê Back to Search</a>

</body>
</html>
