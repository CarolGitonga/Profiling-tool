{% load profile_extras %}
<!DOCTYPE html>
<html>
<head>
    <title>User Profile Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .card {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
        .card img {
            width: 100px;
            border-radius: 50%;
        }
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .remove-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>

{% if profiles %}
    <h1>Dashboard for <strong>{{ profiles.0.username }}</strong></h1>

    {% for profile in profiles %}
        <div class="card">
            <h2>{{ profile.platform }} Profile</h2>

            {% if profile.avatar_url %}
                <img src="{{ profile.avatar_url }}" alt="{{ profile.platform }} avatar"><br>
            {% endif %}

            <p><strong>Full Name:</strong> {{ profile.full_name }}</p>
            {% if profile.date_profiled %}
             <p><em>Profiled {{ profile.date_profiled|timesince }} ago</em></p>
            {% endif %}


            {% if profile.platform == "GitHub" %}
                {% if profile.github_created_at %}
                    <p><strong>Account Created:</strong> {{ profile.github_created_at|date:"F j, Y" }}</p>
                {% endif %}
                {% if profile.location %}<p><strong>Location:</strong> {{ profile.location }}</p>{% endif %}
                {% if profile.company %}<p><strong>Company:</strong> {{ profile.company }}</p>{% endif %}
                {% if profile.blog %}<p><strong>Blog:</strong> <a href="{{ profile.blog }}" target="_blank">{{ profile.blog }}</a></p>{% endif %}
            {% endif %}

            {% with accounts|get_account_for:profile as platform_account %}
                {% if platform_account %}
                    <p><strong>Bio:</strong> {{ platform_account.bio }}</p>
                    <p><strong>Followers:</strong> {{ platform_account.followers }}</p>
                    <p><strong>Following:</strong> {{ platform_account.following }}</p>
                    <p><strong>Public Repos:</strong> {{ platform_account.public_repos }}</p>
                    <form action="{% url 'unscrape_'|add:profile.platform|lower profile.username %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="remove-btn">Remove {{ profile.platform }} Data</button>
                    </form>
                {% else %}
                    <p>No bio data found for {{ profile.platform }}.</p>
                {% endif %}
            {% endwith %}
        </div>
    {% endfor %}

{% else %}
    <p>No profiles found for this user.</p>
{% endif %}

<br>
<a href="{% url 'search_profile' %}">‚Üê Back to Search</a>

</body>
</html>
