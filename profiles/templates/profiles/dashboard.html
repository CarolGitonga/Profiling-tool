{% load profile_extras %}
<!DOCTYPE html>
<html>
<head>
    <title>User Profile Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .card {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #f9f9f9;
        }
        .card img {
            width: 100px;
            border-radius: 50%;
        }
        .remove-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        .remove-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>

{% if profiles %}
    <h1>Dashboard for <strong>{{ profiles.0.username }}</strong></h1>

    {% for profile in profiles %}
        <div class="card">
            <h2>{{ profile.platform }} Profile</h2>

            {% if profile.avatar_url %}
                <img src="{{ profile.avatar_url }}" alt="{{ profile.platform }} avatar"><br>
            {% endif %}

            <p><strong>Full Name:</strong> {{ profile.full_name }}</p>

            {% if profile.platform == 'Twitter' %}
                {% with accounts|get_account_for:profile as twitter_acc %}
                    {% if twitter_acc %}
                        <p><strong>Bio:</strong> {{ twitter_acc.bio }}</p>
                        <p><strong>Followers:</strong> {{ twitter_acc.followers }}</p>
                        <p><strong>Following:</strong> {{ twitter_acc.following|default:'N/A' }}</p>
                        <p><strong>Verified:</strong> {{ profile.verified|yesno:"Yes,No" }}</p>
                        <p><strong>Location:</strong> {{ profile.location|default:"Not specified" }}</p>
                        <p><strong>Twitter Joined:</strong> {{ profile.profile_created_at|date:"F Y" }}</p>
                        <form action="{% url 'unscrape_twitter' profile.username %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="remove-btn">Remove Twitter Data</button>
                        </form>
                    {% endif %}
                {% endwith %}
            {% elif profile.platform == 'GitHub' %}
                {% with accounts|get_account_for:profile as github_acc %}
                    {% if github_acc %}
                        <p><strong>Bio:</strong> {{ github_acc.bio }}</p>
                        <p><strong>Followers:</strong> {{ github_acc.followers }}</p>
                        <p><strong>Following:</strong> {{ github_acc.following }}</p>
                        <p><strong>Public Repositories:</strong> {{ github_acc.public_repos }}</p>
                        <p><strong>Location:</strong> {{ profile.location|default:"Not specified" }}</p>
                        <p><strong>Company:</strong> {{ profile.company|default:"Not specified" }}</p>
                        <p><strong>Website:</strong> 
                            {% if profile.blog %}<a href="{{ profile.blog }}" target="_blank">{{ profile.blog }}</a>{% else %}Not specified{% endif %}
                        </p>
                        <p><strong>GitHub Joined:</strong> {{ profile.github_created_at|date:"F Y" }}</p>
                        <form action="{% url 'unscrape_github' profile.username %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="remove-btn">Remove GitHub Data</button>
                        </form>
                    {% endif %}
                {% endwith %}
            {% endif %}

            <p><em>Profiled {{ profile.date_profiled|timesince }} ago</em></p>
        </div>
    {% endfor %}

{% else %}
    <p>No profiles found for this user.</p>
{% endif %}

<br>
<a href="{% url 'search_profile' %}">‚Üê Back to Search</a>

</body>
</html>
