{% extends "pages/base.html" %}
{% block title %}Behavioral Dashboard – {{ profile.username }}{% endblock %}
{% block content %}

<div class="container py-5">
  <!-- 🧍 Profile Overview -->
  <div class="card shadow-lg border-0 mb-5">
    <div class="card-body d-flex align-items-center">
      <img src="{{ profile.avatar_url }}" alt="{{ profile.username }}"
           class="rounded-circle me-4" width="120" height="120">
      <div>
        <h3 class="fw-bold mb-0">{{ profile.full_name|default:profile.username }}</h3>
        <p class="text-muted mb-2">@{{ profile.username }}</p>
        <p>{{ social.bio|default:"No bio available." }}</p>
        {% if social.external_url %}
        <a href="{{ social.external_url }}" target="_blank" class="btn btn-outline-primary btn-sm">
          🔗 Visit Profile
        </a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- 📊 Behavioral Insights -->
  {% if analysis %}
  <div class="row g-4">

    <!-- Sentiment -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0 p-3 text-center">
        <h5 class="fw-bold mb-3">Sentiment Score</h5>
        <h1 class="display-5 {% if analysis.sentiment_score > 0.2 %}text-success{% elif analysis.sentiment_score < 0 %}text-danger{% else %}text-warning{% endif %}">
          {{ analysis.sentiment_score|floatformat:2 }}
        </h1>
        <p class="text-muted">(-1 = Negative, +1 = Positive)</p>
      </div>
    </div>

    <!-- Network Size -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0 p-3 text-center">
        <h5 class="fw-bold mb-3">Network Size</h5>
        <h2>{{ analysis.network_size|default:0 }}</h2>
        <p class="text-muted">Followers + Following</p>
      </div>
    </div>

    <!-- Avg Post Time -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0 p-3 text-center">
        <h5 class="fw-bold mb-3">Average Posting Time</h5>
        <h2>{{ analysis.avg_post_time|default:"–" }}</h2>
        <p class="text-muted">Most Active: {{ analysis.most_active_days|join:", " }}</p>
      </div>
    </div>
  </div>

  <!-- 🔖 Top Keywords -->
  <div class="card mt-5 shadow-sm border-0 p-4">
    <h5 class="fw-bold mb-4">Top Keywords & Hashtags</h5>
    {% if analysis.top_keywords %}
      {% for key, value in analysis.top_keywords.items %}
        <span class="badge bg-primary me-2 mb-2">#{{ key }} ({{ value }})</span>
      {% endfor %}
    {% else %}
      <p class="text-muted">No keyword data available yet.</p>
    {% endif %}
  </div>

  <!-- 🗓️ Posting Pattern Chart -->
  <div class="card mt-5 shadow-sm border-0 p-4">
    <h5 class="fw-bold mb-4">Posting Pattern (Hours)</h5>
    <canvas id="postingChart"></canvas>
  </div>
  {% else %}
  <div class="alert alert-warning mt-4">
    No behavioral analysis data found for this user yet.
  </div>
  {% endif %}
</div>

<!-- 📈 Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('postingChart');
new Chart(ctx, {
  type: 'bar',
  data: {
    labels: {{ analysis.most_active_days|safe|default:"[]" }},
    datasets: [{
      label: 'Activity Frequency',
      data: [12, 7, 4, 9, 3], // Demo data — you can link real day counts later
      backgroundColor: 'rgba(13, 110, 253, 0.6)',
      borderRadius: 8
    }]
  },
  options: {
    plugins: { legend: { display: false } },
    scales: {
      y: { beginAtZero: true }
    }
  }
});
</script>

{% endblock %}
